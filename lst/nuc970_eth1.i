#line 1 "lwip-1.4.1\\netif\\nuc970_eth1.c"






















 
#line 1 "..\\..\\Driver\\Include\\nuc970.h"
 










 






































 




#line 1 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdint.h"
 
 





 










#line 26 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdint.h"







 

     

     
typedef   signed          char int8_t;
typedef   signed short     int int16_t;
typedef   signed           int int32_t;
typedef   signed       __int64 int64_t;

     
typedef unsigned          char uint8_t;
typedef unsigned short     int uint16_t;
typedef unsigned           int uint32_t;
typedef unsigned       __int64 uint64_t;

     

     
     
typedef   signed          char int_least8_t;
typedef   signed short     int int_least16_t;
typedef   signed           int int_least32_t;
typedef   signed       __int64 int_least64_t;

     
typedef unsigned          char uint_least8_t;
typedef unsigned short     int uint_least16_t;
typedef unsigned           int uint_least32_t;
typedef unsigned       __int64 uint_least64_t;

     

     
typedef   signed           int int_fast8_t;
typedef   signed           int int_fast16_t;
typedef   signed           int int_fast32_t;
typedef   signed       __int64 int_fast64_t;

     
typedef unsigned           int uint_fast8_t;
typedef unsigned           int uint_fast16_t;
typedef unsigned           int uint_fast32_t;
typedef unsigned       __int64 uint_fast64_t;

     
typedef   signed           int intptr_t;
typedef unsigned           int uintptr_t;

     
typedef   signed       __int64 intmax_t;
typedef unsigned       __int64 uintmax_t;




     

     





     





     





     

     





     





     





     

     





     





     





     

     


     


     


     

     


     


     


     

     



     



     


     
    
 



#line 197 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdint.h"

     







     










     











#line 261 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdint.h"



 



#line 57 "..\\..\\Driver\\Include\\nuc970.h"




 

 
#line 82 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 120 "..\\..\\Driver\\Include\\nuc970.h"

   

 
 
 



 

 



 

#line 174 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

#line 200 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 216 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 260 "..\\..\\Driver\\Include\\nuc970.h"

#line 295 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

#line 329 "..\\..\\Driver\\Include\\nuc970.h"

   



 



 
#line 362 "..\\..\\Driver\\Include\\nuc970.h"

#line 373 "..\\..\\Driver\\Include\\nuc970.h"

#line 384 "..\\..\\Driver\\Include\\nuc970.h"

#line 395 "..\\..\\Driver\\Include\\nuc970.h"

#line 406 "..\\..\\Driver\\Include\\nuc970.h"

#line 417 "..\\..\\Driver\\Include\\nuc970.h"

#line 428 "..\\..\\Driver\\Include\\nuc970.h"

#line 439 "..\\..\\Driver\\Include\\nuc970.h"

#line 450 "..\\..\\Driver\\Include\\nuc970.h"

#line 461 "..\\..\\Driver\\Include\\nuc970.h"

#line 472 "..\\..\\Driver\\Include\\nuc970.h"

#line 483 "..\\..\\Driver\\Include\\nuc970.h"

#line 496 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 540 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 567 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

#line 608 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

 
#line 624 "..\\..\\Driver\\Include\\nuc970.h"





 
#line 638 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 655 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 669 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 677 "..\\..\\Driver\\Include\\nuc970.h"

 



   


 



 

 
#line 698 "..\\..\\Driver\\Include\\nuc970.h"





 
#line 713 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

 



 
#line 738 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 746 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 812 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 862 "..\\..\\Driver\\Include\\nuc970.h"

 
#line 886 "..\\..\\Driver\\Include\\nuc970.h"

   




 



 

#line 914 "..\\..\\Driver\\Include\\nuc970.h"






 
#line 937 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 957 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 977 "..\\..\\Driver\\Include\\nuc970.h"




 
#line 998 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 1018 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 1038 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 1058 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 1078 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 1098 "..\\..\\Driver\\Include\\nuc970.h"



 
#line 1118 "..\\..\\Driver\\Include\\nuc970.h"


   


 



 























   

 



 

#line 1166 "..\\..\\Driver\\Include\\nuc970.h"

#line 1174 "..\\..\\Driver\\Include\\nuc970.h"

#line 1182 "..\\..\\Driver\\Include\\nuc970.h"

#line 1190 "..\\..\\Driver\\Include\\nuc970.h"
   

 



 




   

 



 






   

 



 

#line 1238 "..\\..\\Driver\\Include\\nuc970.h"

#line 1255 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 1301 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 1323 "..\\..\\Driver\\Include\\nuc970.h"

#line 1336 "..\\..\\Driver\\Include\\nuc970.h"

#line 1349 "..\\..\\Driver\\Include\\nuc970.h"

#line 1362 "..\\..\\Driver\\Include\\nuc970.h"

#line 1375 "..\\..\\Driver\\Include\\nuc970.h"

#line 1388 "..\\..\\Driver\\Include\\nuc970.h"

#line 1401 "..\\..\\Driver\\Include\\nuc970.h"

#line 1414 "..\\..\\Driver\\Include\\nuc970.h"

#line 1427 "..\\..\\Driver\\Include\\nuc970.h"

#line 1440 "..\\..\\Driver\\Include\\nuc970.h"




   


 



 

#line 1484 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

#line 1499 "..\\..\\Driver\\Include\\nuc970.h"

#line 1506 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 1527 "..\\..\\Driver\\Include\\nuc970.h"

#line 1539 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 1566 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 1600 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

#line 1636 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

#line 1658 "..\\..\\Driver\\Include\\nuc970.h"

   

 



 

#line 1706 "..\\..\\Driver\\Include\\nuc970.h"

#line 1746 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 

#line 1771 "..\\..\\Driver\\Include\\nuc970.h"

   


 



 
#line 1823 "..\\..\\Driver\\Include\\nuc970.h"

   



   





 

typedef volatile unsigned char  vu8;        
typedef volatile unsigned short vu16;       
typedef volatile unsigned long  vu32;       





 







 







 








 







 








 







 







 






 








 







 








 







 







 






 



   

 
 
 



 
typedef void *            PVOID;    
typedef void              VOID;     
typedef char              BOOL;     
typedef char *            PBOOL;    

typedef char              INT8;     
typedef char              CHAR;     
typedef char *            PINT8;    
typedef char *            PCHAR;    
typedef unsigned char     UINT8;    
typedef unsigned char     UCHAR;    
typedef unsigned char *   PUINT8;   
typedef unsigned char *   PUCHAR;   
typedef char *            PSTR;     
typedef const char *      PCSTR;    

typedef short             SHORT;    
typedef short *           PSHORT;   
typedef unsigned short    USHORT;   
typedef unsigned short *  PUSHORT;  

typedef short             INT16;    
typedef short *           PINT16;   
typedef unsigned short    UINT16;   
typedef unsigned short *  PUINT16;  

typedef int               INT;      
typedef int *             PINT;     
typedef unsigned int      UINT;     
typedef unsigned int *    PUINT;    

typedef int               INT32;    
typedef int *             PINT32;   
typedef unsigned int      UINT32;   
typedef unsigned int *    PUINT32;  

typedef __int64           INT64;    
typedef unsigned __int64  UINT64;   

typedef float             FLOAT;    
typedef float *           PFLOAT;   

typedef double            DOUBLE;   
typedef double *          PDOUBLE;  

typedef int               SIZE_T;   

typedef unsigned char     REG8;     
typedef unsigned short    REG16;    
typedef unsigned int      REG32;    
















 
#line 2070 "..\\..\\Driver\\Include\\nuc970.h"

 













   
#line 25 "lwip-1.4.1\\netif\\nuc970_eth1.c"
#line 1 "..\\..\\Driver\\Include\\sys.h"
 








 











 



 



 



 
typedef enum IRQn {

     

    WDT_IRQn                = 1,        
    WWDT_IRQn               = 2,        
    LVD_IRQn                = 3,        
    EINT0_IRQn              = 4,        
    EINT1_IRQn              = 5,        
    EINT2_IRQn              = 6,        
    EINT3_IRQn              = 7,        
    EINT4_IRQn              = 8,        
    EINT5_IRQn              = 9,        
    EINT6_IRQn              = 10,       
    EINT7_IRQn              = 11,       
    ACTL_IRQn               = 12,       
    LCD_IRQn                = 13,       
    CAP_IRQn                = 14,       
    RTC_IRQn                = 15,       
    TMR0_IRQn               = 16,       
    TMR1_IRQn               = 17,       
    ADC_IRQn                = 18,       
    EMC0_RX_IRQn            = 19,       
    EMC1_RX_IRQn            = 20,       
    EMC0_TX_IRQn            = 21,       
    EMC1_TX_IRQn            = 22,       
    EHCI_IRQn               = 23,       
    OHCI_IRQn               = 24,       
    GDMA0_IRQn              = 25,       
    GDMA1_IRQn              = 26,       
    SDH_IRQn                = 27,       
    FMI_IRQn                = 28,       
    USBD_IRQn               = 29,       
    TMR2_IRQn               = 30,       
    TMR3_IRQn               = 31,       
    TMR4_IRQn               = 32,       
    JPEG_IRQn               = 33,       
    GE2D_IRQn               = 34,       
    CRPT_IRQn               = 35,       
    UART0_IRQn              = 36,       
    UART1_IRQn              = 37,       
    UART2_IRQn              = 38,       
    UART4_IRQn              = 39,       
    UART6_IRQn              = 40,       
    UART8_IRQn              = 41,       
    UART10_IRQn             = 42,       
    UART3_IRQn              = 43,       
    UART5_IRQn              = 44,       
    UART7_IRQn              = 45,       
    UART9_IRQn              = 46,       
    ETMR0_IRQn              = 47,       
    ETMR1_IRQn              = 48,       
    ETMR2_IRQn              = 49,       
    ETMR3_IRQn              = 50,       
    SPI0_IRQn               = 51,       
    SPI1_IRQn               = 52,       
    I2C0_IRQn               = 53,       
    I2C1_IRQn               = 54,       
    SC0_IRQn                = 55,       
    SC1_IRQn                = 56,       
    GPIO_IRQn               = 57,       
    CAN0_IRQn               = 58,       
    CAN1_IRQn               = 59,       
    PWM_IRQn                = 60,       
    KPI_IRQn                = 61,       
}
IRQn_Type;

 








 
#line 121 "..\\..\\Driver\\Include\\sys.h"






 





 
#line 140 "..\\..\\Driver\\Include\\sys.h"

 





 
typedef enum CLKn {

    SYS_UPLL     = 1,    
    SYS_APLL     = 2,    
    SYS_SYSTEM   = 3,    
    SYS_HCLK1    = 4,    
    SYS_HCLK234  = 5,    
    SYS_PCLK     = 6,    
    SYS_CPU      = 7,    

}  CLK_Type;




typedef struct datetime_t {
    UINT32  year;
    UINT32  mon;
    UINT32  day;
    UINT32  hour;
    UINT32  min;
    UINT32  sec;
} DateTime_T;

 





 







 
#line 194 "..\\..\\Driver\\Include\\sys.h"

 















    




 

 
UINT32  sysGetTicks (INT32 nTimeNo);
INT32   sysResetTicks (INT32 nTimeNo);
INT32   sysUpdateTickCount(INT32 nTimeNo, UINT32 uCount);
INT32   sysSetTimerReferenceClock (INT32 nTimeNo, UINT32 uClockRate);
INT32   sysStartTimer (INT32 nTimeNo, UINT32 uTicksPerSecond, INT32 nOpMode);
INT32   sysStopTimer (INT32 nTimeNo);
void    sysClearWatchDogTimerCount (void);
void    sysClearWatchDogTimerInterruptStatus(void);
void    sysDisableWatchDogTimer (void);
void    sysDisableWatchDogTimerReset(void);
void    sysEnableWatchDogTimer (void);
void    sysEnableWatchDogTimerReset(void);
PVOID   sysInstallWatchDogTimerISR (INT32 nIntTypeLevel, PVOID pvNewISR);
INT32   sysSetWatchDogTimerInterval (INT32 nWdtInterval);
INT32   sysSetTimerEvent(INT32 nTimeNo, UINT32 uTimeTick, PVOID pvFun);
void    sysClearTimerEvent(INT32 nTimeNo, UINT32 uTimeEventNo);
void    sysSetLocalTime(DateTime_T ltime);           
void    sysGetCurrentTime(DateTime_T *curTime);      
void    sysDelay(UINT32 uTicks);

 
INT8    sysGetChar (void);
INT32   sysInitializeUART (void);
void    sysprintf (PINT8 pcStr,...);
void    sysPutChar (UINT8 ucCh);
INT     sysIsKbHit(void);

 
INT32   sysDisableInterrupt (IRQn_Type eIntNo);
INT32   sysEnableInterrupt (IRQn_Type eIntNo);
BOOL    sysGetIBitState(void);               
UINT32  sysGetInterruptEnableStatus(void);   
UINT32  sysGetInterruptEnableStatusH(void);  
PVOID   sysInstallExceptionHandler (INT32 nExceptType, PVOID pvNewHandler);
PVOID   sysInstallFiqHandler (PVOID pvNewISR);
PVOID   sysInstallIrqHandler (PVOID pvNewISR);
PVOID   sysInstallISR (INT32 nIntTypeLevel, IRQn_Type eIntNo, PVOID pvNewISR);
INT32   sysSetGlobalInterrupt (INT32 nIntState);     
INT32   sysSetInterruptPriorityLevel (IRQn_Type eIntNo, UINT32 uIntLevel);
INT32   sysSetInterruptType (IRQn_Type eIntNo, UINT32 uIntSourceType);       
INT32   sysSetLocalInterrupt (INT32 nIntState);


 
void    sysDisableCache(void);
INT32   sysEnableCache(UINT32 uCacheOpMode);
void    sysFlushCache(INT32 nCacheType);     
BOOL    sysGetCacheState(void);              
INT32   sysGetSdramSizebyMB(void);           
void    sysInvalidCache(void);               
INT32   sysSetCachePages(UINT32 addr, INT32 size, INT32 cache_mode);     

 
INT32   sysSetExternalIO(INT extNo, UINT32 extBaseAddr, UINT32 extSize, INT extBusWidth);  
INT32   sysSetExternalIOTiming1(INT extNo, INT tACC, INT tACS);  
INT32   sysSetExternalIOTiming2(INT extNo, INT tCOH, INT tCOS);  

int sysSetMMUMappingMethod(int mode);    

UINT32 sysGetClock(CLK_Type clk);

typedef void (*sys_pvFunPtr)();    
extern sys_pvFunPtr sysIrqHandlerTable[];
extern BOOL volatile _sys_bIsAICInitial;





   

   

   



 

#line 26 "lwip-1.4.1\\netif\\nuc970_eth1.c"
#line 1 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"






















 
#line 1 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/def.h"






























 



 
#line 1 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/arch.h"






























 











#line 1 ".\\lwip-1.4.1\\include\\arch/cc.h"






























 
#line 35 ".\\lwip-1.4.1\\include\\arch/cc.h"
#line 36 ".\\lwip-1.4.1\\include\\arch/cc.h"
#line 1 ".\\lwip-1.4.1\\include\\arch/cpu.h"






























 





#line 37 ".\\lwip-1.4.1\\include\\arch/cc.h"
#line 1 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdio.h"
 
 
 





 






 













#line 38 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdio.h"


  
  typedef unsigned int size_t;    








 
 

 
  typedef struct __va_list __va_list;





   




 




typedef struct __fpos_t_struct {
    unsigned __int64 __pos;
    



 
    struct {
        unsigned int __state1, __state2;
    } __mbstate;
} fpos_t;
   


 


   

 

typedef struct __FILE FILE;
   






 

extern FILE __stdin, __stdout, __stderr;
extern FILE *__aeabi_stdin, *__aeabi_stdout, *__aeabi_stderr;

#line 129 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdio.h"
    

    

    





     



   


 


   


 

   



 

   


 




   


 





    


 






extern __declspec(__nothrow) int remove(const char *  ) __attribute__((__nonnull__(1)));
   





 
extern __declspec(__nothrow) int rename(const char *  , const char *  ) __attribute__((__nonnull__(1,2)));
   








 
extern __declspec(__nothrow) FILE *tmpfile(void);
   




 
extern __declspec(__nothrow) char *tmpnam(char *  );
   











 

extern __declspec(__nothrow) int fclose(FILE *  ) __attribute__((__nonnull__(1)));
   







 
extern __declspec(__nothrow) int fflush(FILE *  );
   







 
extern __declspec(__nothrow) FILE *fopen(const char * __restrict  ,
                           const char * __restrict  ) __attribute__((__nonnull__(1,2)));
   








































 
extern __declspec(__nothrow) FILE *freopen(const char * __restrict  ,
                    const char * __restrict  ,
                    FILE * __restrict  ) __attribute__((__nonnull__(2,3)));
   








 
extern __declspec(__nothrow) void setbuf(FILE * __restrict  ,
                    char * __restrict  ) __attribute__((__nonnull__(1)));
   




 
extern __declspec(__nothrow) int setvbuf(FILE * __restrict  ,
                   char * __restrict  ,
                   int  , size_t  ) __attribute__((__nonnull__(1)));
   















 
#pragma __printf_args
extern __declspec(__nothrow) int fprintf(FILE * __restrict  ,
                    const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   


















 
#pragma __printf_args
extern __declspec(__nothrow) int _fprintf(FILE * __restrict  ,
                     const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   



 
#pragma __printf_args
extern __declspec(__nothrow) int printf(const char * __restrict  , ...) __attribute__((__nonnull__(1)));
   




 
#pragma __printf_args
extern __declspec(__nothrow) int _printf(const char * __restrict  , ...) __attribute__((__nonnull__(1)));
   



 
#pragma __printf_args
extern __declspec(__nothrow) int sprintf(char * __restrict  , const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   






 
#pragma __printf_args
extern __declspec(__nothrow) int _sprintf(char * __restrict  , const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   



 

#pragma __printf_args
extern __declspec(__nothrow) int snprintf(char * __restrict  , size_t  ,
                     const char * __restrict  , ...) __attribute__((__nonnull__(3)));
   















 

#pragma __printf_args
extern __declspec(__nothrow) int _snprintf(char * __restrict  , size_t  ,
                      const char * __restrict  , ...) __attribute__((__nonnull__(3)));
   



 
#pragma __scanf_args
extern __declspec(__nothrow) int fscanf(FILE * __restrict  ,
                    const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   






























 
#pragma __scanf_args
extern __declspec(__nothrow) int _fscanf(FILE * __restrict  ,
                     const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   



 
#pragma __scanf_args
extern __declspec(__nothrow) int scanf(const char * __restrict  , ...) __attribute__((__nonnull__(1)));
   






 
#pragma __scanf_args
extern __declspec(__nothrow) int _scanf(const char * __restrict  , ...) __attribute__((__nonnull__(1)));
   



 
#pragma __scanf_args
extern __declspec(__nothrow) int sscanf(const char * __restrict  ,
                    const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   








 
#pragma __scanf_args
extern __declspec(__nothrow) int _sscanf(const char * __restrict  ,
                     const char * __restrict  , ...) __attribute__((__nonnull__(1,2)));
   



 

 
extern __declspec(__nothrow) int vfscanf(FILE * __restrict  , const char * __restrict  , __va_list) __attribute__((__nonnull__(1,2)));
extern __declspec(__nothrow) int vscanf(const char * __restrict  , __va_list) __attribute__((__nonnull__(1)));
extern __declspec(__nothrow) int vsscanf(const char * __restrict  , const char * __restrict  , __va_list) __attribute__((__nonnull__(1,2)));

extern __declspec(__nothrow) int _vfscanf(FILE * __restrict  , const char * __restrict  , __va_list) __attribute__((__nonnull__(1,2)));
extern __declspec(__nothrow) int _vscanf(const char * __restrict  , __va_list) __attribute__((__nonnull__(1)));
extern __declspec(__nothrow) int _vsscanf(const char * __restrict  , const char * __restrict  , __va_list) __attribute__((__nonnull__(1,2)));

extern __declspec(__nothrow) int vprintf(const char * __restrict  , __va_list  ) __attribute__((__nonnull__(1)));
   





 
extern __declspec(__nothrow) int _vprintf(const char * __restrict  , __va_list  ) __attribute__((__nonnull__(1)));
   



 
extern __declspec(__nothrow) int vfprintf(FILE * __restrict  ,
                    const char * __restrict  , __va_list  ) __attribute__((__nonnull__(1,2)));
   






 
extern __declspec(__nothrow) int vsprintf(char * __restrict  ,
                     const char * __restrict  , __va_list  ) __attribute__((__nonnull__(1,2)));
   






 

extern __declspec(__nothrow) int vsnprintf(char * __restrict  , size_t  ,
                     const char * __restrict  , __va_list  ) __attribute__((__nonnull__(3)));
   







 

extern __declspec(__nothrow) int _vsprintf(char * __restrict  ,
                      const char * __restrict  , __va_list  ) __attribute__((__nonnull__(1,2)));
   



 
extern __declspec(__nothrow) int _vfprintf(FILE * __restrict  ,
                     const char * __restrict  , __va_list  ) __attribute__((__nonnull__(1,2)));
   



 
extern __declspec(__nothrow) int _vsnprintf(char * __restrict  , size_t  ,
                      const char * __restrict  , __va_list  ) __attribute__((__nonnull__(3)));
   



 
extern __declspec(__nothrow) int fgetc(FILE *  ) __attribute__((__nonnull__(1)));
   







 
extern __declspec(__nothrow) char *fgets(char * __restrict  , int  ,
                    FILE * __restrict  ) __attribute__((__nonnull__(1,3)));
   










 
extern __declspec(__nothrow) int fputc(int  , FILE *  ) __attribute__((__nonnull__(2)));
   







 
extern __declspec(__nothrow) int fputs(const char * __restrict  , FILE * __restrict  ) __attribute__((__nonnull__(1,2)));
   




 
extern __declspec(__nothrow) int getc(FILE *  ) __attribute__((__nonnull__(1)));
   







 




    extern __declspec(__nothrow) int (getchar)(void);

   





 
extern __declspec(__nothrow) char *gets(char *  ) __attribute__((__nonnull__(1)));
   









 
extern __declspec(__nothrow) int putc(int  , FILE *  ) __attribute__((__nonnull__(2)));
   





 




    extern __declspec(__nothrow) int (putchar)(int  );

   



 
extern __declspec(__nothrow) int puts(const char *  ) __attribute__((__nonnull__(1)));
   





 
extern __declspec(__nothrow) int ungetc(int  , FILE *  ) __attribute__((__nonnull__(2)));
   






















 

extern __declspec(__nothrow) size_t fread(void * __restrict  ,
                    size_t  , size_t  , FILE * __restrict  ) __attribute__((__nonnull__(1,4)));
   











 

extern __declspec(__nothrow) size_t __fread_bytes_avail(void * __restrict  ,
                    size_t  , FILE * __restrict  ) __attribute__((__nonnull__(1,3)));
   











 

extern __declspec(__nothrow) size_t fwrite(const void * __restrict  ,
                    size_t  , size_t  , FILE * __restrict  ) __attribute__((__nonnull__(1,4)));
   







 

extern __declspec(__nothrow) int fgetpos(FILE * __restrict  , fpos_t * __restrict  ) __attribute__((__nonnull__(1,2)));
   








 
extern __declspec(__nothrow) int fseek(FILE *  , long int  , int  ) __attribute__((__nonnull__(1)));
   














 
extern __declspec(__nothrow) int fsetpos(FILE * __restrict  , const fpos_t * __restrict  ) __attribute__((__nonnull__(1,2)));
   










 
extern __declspec(__nothrow) long int ftell(FILE *  ) __attribute__((__nonnull__(1)));
   











 
extern __declspec(__nothrow) void rewind(FILE *  ) __attribute__((__nonnull__(1)));
   





 

extern __declspec(__nothrow) void clearerr(FILE *  ) __attribute__((__nonnull__(1)));
   




 

extern __declspec(__nothrow) int feof(FILE *  ) __attribute__((__nonnull__(1)));
   


 
extern __declspec(__nothrow) int ferror(FILE *  ) __attribute__((__nonnull__(1)));
   


 
extern __declspec(__nothrow) void perror(const char *  );
   









 

extern __declspec(__nothrow) int _fisatty(FILE *   ) __attribute__((__nonnull__(1)));
    
 

extern __declspec(__nothrow) void __use_no_semihosting_swi(void);
extern __declspec(__nothrow) void __use_no_semihosting(void);
    





 











#line 948 "E:\\Keil\\Keil_v4\\ARM\\ARMCC\\bin\\..\\include\\stdio.h"



 

#line 38 ".\\lwip-1.4.1\\include\\arch/cc.h"

 

typedef unsigned   char    u8_t;     
typedef signed     char    s8_t;     
typedef unsigned   short   u16_t;    
typedef signed     short   s16_t;    
typedef unsigned   long    u32_t;    
typedef signed     long    s32_t;    
typedef u32_t mem_ptr_t;             
typedef u32_t sys_prot_t;

 

 
#line 62 ".\\lwip-1.4.1\\include\\arch/cc.h"






#line 83 ".\\lwip-1.4.1\\include\\arch/cc.h"

 

#line 92 ".\\lwip-1.4.1\\include\\arch/cc.h"

 
#line 100 ".\\lwip-1.4.1\\include\\arch/cc.h"







u32_t _LWIP_RAND(void);

#line 44 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/arch.h"

 




 





























#line 137 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/arch.h"



#line 204 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/arch.h"





extern int errno;








#line 37 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/def.h"
#line 1 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/opt.h"




 































 






 
#line 1 ".\\lwip-1.4.1\\include\\lwipopts.h"




 































 






 
#line 1 ".\\lwip-1.4.1\\include\\lwipopts.h"




 































 
#line 46 ".\\lwip-1.4.1\\include\\lwipopts.h"
#line 1 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/debug.h"






























 



#line 36 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/debug.h"
#line 1 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/opt.h"




 































 
#line 37 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/debug.h"






 
#line 50 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/debug.h"

 

 


 

 

 

 


#line 71 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/debug.h"

 





#line 97 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/debug.h"



#line 47 ".\\lwip-1.4.1\\include\\lwipopts.h"





 





 





 






 





 





 






 




 





 






 





 





 





 





 







 





 





 





 






 






 




 






 


 






 




 






 






 






 






 







 






 




 






 



 






 


 






 


 







 


 






 



 






 


 






 



 






 


 






 


 








 





 







 






 


 






 



 






 


 






 


 





 


 



 




#line 46 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/opt.h"
#line 47 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/opt.h"





 





 







 







 







 







 








 




 








 








 







 








 












 







 









 







 









 





















 








 




 







 








 







 







 







 







 










 









 









 









 







 







 








 








 






 







 








 








 







 







 







 






 








 


 






 










 













 











 






 








 






 









 




 








 








 








 








 









 










 







 






 








 







 










 








 








 



 






 






 






 








 


 






 








 


 






 








 


 







 










 








 



 








 







 








 








 







 








 







 








 


 








 



 




 




 




 




 




 













 





 








 


 






 






 






 








 


 






 







 






 






 







 










 











 








 







 








 








 







 







 






 








 

















 






 







 










 










 




 








 








 



 






 







 







 







 










 







 







 
















 












 








 


 








 


 








 


 








 








 








 






 








 








 






 








 








 






 








 








 








 








 








 








 








 



 







 






 






 








 


 







 








 








 







 







 






 






 






 








 








 


 




#line 1603 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/opt.h"

#line 1615 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/opt.h"







 


 






 






 




#line 1781 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/opt.h"





 


 



 


 



 


 






 



 


 



 


 






 







 








 

 











 







 





 




 







 






 






 






 






 






 






 






 






 






 






 






 






 






 






 






 






 






 






 






 







 






 






 






 






 






 






 






 






 






 






 






 






 






 






 




#line 38 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/def.h"












 











 

#line 76 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/def.h"







#line 99 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/def.h"
u16_t lwip_htons(u16_t x);
u16_t lwip_ntohs(u16_t x);
u32_t lwip_htonl(u32_t x);
u32_t lwip_ntohl(u32_t x);




 
#line 115 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/def.h"









#line 25 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"
#line 1 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/pbuf.h"






























 




#line 37 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/pbuf.h"
#line 1 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/err.h"






























 



#line 36 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/err.h"
#line 37 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/err.h"






 



typedef s8_t err_t;


 

#line 62 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/err.h"














extern const char *lwip_strerr(err_t err);








#line 38 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/pbuf.h"






 





typedef enum {
  PBUF_TRANSPORT,
  PBUF_IP,
  PBUF_LINK,
  PBUF_RAW
} pbuf_layer;

typedef enum {
  PBUF_RAM,  
  PBUF_ROM,  
  PBUF_REF,  
  PBUF_POOL  
} pbuf_type;


 


 

 

 

 

 

 


struct pbuf {
   
  struct pbuf *next;

   
  void *payload;

  





 
  u16_t tot_len;

   
  u16_t len;

   
  u8_t   type;

   
  u8_t flags;

  



 
  u16_t ref;
#line 119 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/pbuf.h"
};

#line 133 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/pbuf.h"


 




extern volatile u8_t pbuf_free_ooseq_pending;
void pbuf_free_ooseq();


 
#line 151 "..\\..\\ThirdParty\\lwip-1.4.1\\src\\include\\lwip/pbuf.h"

 


struct pbuf *pbuf_alloc(pbuf_layer l, u16_t length, pbuf_type type);





void pbuf_realloc(struct pbuf *p, u16_t size); 
u8_t pbuf_header(struct pbuf *p, s16_t header_size);
void pbuf_ref(struct pbuf *p);
u8_t pbuf_free(struct pbuf *p);
u8_t pbuf_clen(struct pbuf *p);  
void pbuf_cat(struct pbuf *head, struct pbuf *tail);
void pbuf_chain(struct pbuf *head, struct pbuf *tail);
struct pbuf *pbuf_dechain(struct pbuf *p);
err_t pbuf_copy(struct pbuf *p_to, struct pbuf *p_from);
u16_t pbuf_copy_partial(struct pbuf *p, void *dataptr, u16_t len, u16_t offset);
err_t pbuf_take(struct pbuf *buf, const void *dataptr, u16_t len);
struct pbuf *pbuf_coalesce(struct pbuf *p, pbuf_layer layer);





u8_t pbuf_get_at(struct pbuf* p, u16_t offset);
u16_t pbuf_memcmp(struct pbuf* p, u16_t offset, const void* s2, u16_t n);
u16_t pbuf_memfind(struct pbuf* p, const void* mem, u16_t mem_len, u16_t start_offset);
u16_t pbuf_strstr(struct pbuf* p, const char* substr);





#line 26 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"
#line 27 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"



 

#line 50 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"

 
#line 62 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"

 
#line 76 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"

 
#line 89 ".\\lwip-1.4.1\\include\\netif/nuc970_eth.h"































struct eth_descriptor;
struct eth_descriptor {
    unsigned int  status1;
    unsigned char *buf;
    unsigned int  status2;
    struct eth_descriptor *next;
};



extern void ETH0_init(u8_t *mac_addr);
extern u8_t *ETH0_get_tx_buf(void);
extern void ETH0_trigger_tx(u16_t length, struct pbuf *p);
extern void ethernetif_input0(u16_t len, u8_t *buf);
extern void ETH1_init(u8_t *mac_addr);
extern u8_t *ETH1_get_tx_buf(void);
extern void ETH1_trigger_tx(u16_t length, struct pbuf *p);
extern void ethernetif_input1(u16_t len, u8_t *buf);
#line 27 "lwip-1.4.1\\netif\\nuc970_eth1.c"
#line 28 "lwip-1.4.1\\netif\\nuc970_eth1.c"
#line 29 "lwip-1.4.1\\netif\\nuc970_eth1.c"


#line 37 "lwip-1.4.1\\netif\\nuc970_eth1.c"






static struct eth_descriptor rx_desc[4] __attribute__ ((aligned(4)));
static struct eth_descriptor tx_desc[4] __attribute__ ((aligned(4)));

static struct eth_descriptor volatile *cur_tx_desc_ptr, *cur_rx_desc_ptr, *fin_tx_desc_ptr;

static u8_t rx_buf[4][1520];
static u8_t tx_buf[4][1520];
static int plugged = 0;

extern void ethernetif_input1(u16_t len, u8_t *buf);


static void mdio_write(u8_t addr, u8_t reg, u16_t val)
{

    *((volatile unsigned int *)((0xB0003000+0x094))) = val;
    *((volatile unsigned int *)((0xB0003000+0x098))) = (addr << 8) | reg | 0xB0000;

    while ((*((volatile unsigned int *)((0xB0003000+0x098)))) & 0x20000);    

}


static u16_t mdio_read(u8_t addr, u8_t reg)
{
    *((volatile unsigned int *)((0xB0003000+0x098))) = (addr << 8) | reg | 0xA0000;
    while ((*((volatile unsigned int *)((0xB0003000+0x098)))) & 0x20000);    

    return (*((volatile unsigned int *)((0xB0003000+0x094))));
}

static int reset_phy(void)
{

    u16_t reg;
    u32_t delay;


    mdio_write(0, 0x00, 0x8000);

    delay = 2000;
    while(delay-- > 0) {
        if((mdio_read(0, 0x00) & 0x8000) == 0)
            break;

    }

    if(delay == 0) {
        sysprintf("Reset phy failed\n");
        return(-1);
    }

    mdio_write(0, 0x04, 0x0001 |
               0x0020 |
               0x0040 |
               0x0080 |
               0x0100);

    reg = mdio_read(0, 0x00);
    mdio_write(0, 0x00, reg | 0x0200);

    delay = 200000;
    while(delay-- > 0) {
        if((mdio_read(0, 0x01) & (0x0020 | 0x0004))
                == (0x0020 | 0x0004))
            break;
    }

    if(delay == 0) {
        sysprintf("AN failed. Set to 100 FULL\n");
        *((volatile unsigned int *)((0xB0003000+0x090))) = (*((volatile unsigned int *)((0xB0003000+0x090)))) | 0x140000;
        plugged = 0;
        return(-1);
    } else {
        reg = mdio_read(0, 0x05);

        if(reg & 0x0100) {
            sysprintf("100 full\n");
            *((volatile unsigned int *)((0xB0003000+0x090))) = (*((volatile unsigned int *)((0xB0003000+0x090)))) | 0x140000;
        } else if(reg & 0x0080) {
            sysprintf("100 half\n");
            *((volatile unsigned int *)((0xB0003000+0x090))) = ((*((volatile unsigned int *)((0xB0003000+0x090)))) & ~0x40000) | 0x100000;
        } else if(reg & 0x0040) {
            sysprintf("10 full\n");
            *((volatile unsigned int *)((0xB0003000+0x090))) = ((*((volatile unsigned int *)((0xB0003000+0x090)))) & ~0x100000) | 0x40000;
        } else {
            sysprintf("10 half\n");
            *((volatile unsigned int *)((0xB0003000+0x090))) = (*((volatile unsigned int *)((0xB0003000+0x090)))) & ~0x140000;
        }
    }

    return(0);
}


static void init_tx_desc(void)
{
    u32_t i;


    cur_tx_desc_ptr = fin_tx_desc_ptr = (struct eth_descriptor *)((UINT)(&tx_desc[0]) | 0x80000000);

    for(i = 0; i < 4; i++) {
        tx_desc[i].status1 = 0x01 | 0x02 | 0x04;
        tx_desc[i].buf = (unsigned char *)((UINT)(&tx_buf[i][0]) | 0x80000000);
        tx_desc[i].status2 = 0;
        tx_desc[i].next = (struct eth_descriptor *)((UINT)(&tx_desc[(i + 1) % 4]) | 0x80000000);
    }
    *((volatile unsigned int *)((0xB0003000+0x088))) = (unsigned int)&tx_desc[0] | 0x80000000;
    return;
}

static void init_rx_desc(void)
{
    u32_t i;


    cur_rx_desc_ptr = (struct eth_descriptor *)((UINT)(&rx_desc[0]) | 0x80000000);

    for(i = 0; i < 4; i++) {
        rx_desc[i].status1 = 0x80000000;
        rx_desc[i].buf = (unsigned char *)((UINT)(&rx_buf[i][0]) | 0x80000000);
        rx_desc[i].status2 = 0;
        rx_desc[i].next = (struct eth_descriptor *)((UINT)(&rx_desc[(i + 1) % 4]) | 0x80000000);
    }
    *((volatile unsigned int *)((0xB0003000+0x08C))) = (unsigned int)&rx_desc[0] | 0x80000000;
    return;
}

static void set_mac_addr(u8_t *addr)
{

    *((volatile unsigned int *)(((0xB0003000+0x008)+(0)*0x8))) = (addr[0] << 24) | (addr[1] << 16) | (addr[2] << 8) | addr[3];



    *((volatile unsigned int *)(((0xB0003000+0x00c)+(0)*0x8))) = (addr[4] << 24) | (addr[5] << 16);

    *((volatile unsigned int *)((0xB0003000+0x000))) = 0x16;
    *((volatile unsigned int *)((0xB0003000+0x004))) = 1;    

}


void ETH1_halt(void)
{

    *((volatile unsigned int *)((0xB0003000+0x090))) = (*((volatile unsigned int *)((0xB0003000+0x090)))) & ~0x101; 

}

void ETH1_RX_IRQHandler(void)
{
    unsigned int status;

    status = (*((volatile unsigned int *)((0xB0003000+0x0b0)))) & 0xFFFF;
    *((volatile unsigned int *)((0xB0003000+0x0b0))) = status;

    if (status & 0x800) {
        
    }

    do {
        status = cur_rx_desc_ptr->status1;

        if(status & 0x80000000)
            break;

        if (status & 0x00100000) {

            ethernetif_input1(status & 0xFFFF, cur_rx_desc_ptr->buf);


        }

        cur_rx_desc_ptr->status1 = 0x80000000;
        cur_rx_desc_ptr = cur_rx_desc_ptr->next;

    } while (1);

    *((volatile unsigned int *)((0xB0003000+0x0a4))) = 0;

}

void ETH1_TX_IRQHandler(void)
{
    unsigned int cur_entry, status;

    status = (*((volatile unsigned int *)((0xB0003000+0x0b0)))) & 0xFFFF0000;
    *((volatile unsigned int *)((0xB0003000+0x0b0))) = status;

    if(status & 0x1000000) {
        
        return;
    }

    cur_entry = (*((volatile unsigned int *)((0xB0003000+0x0cc))));

    while (cur_entry != (u32_t)fin_tx_desc_ptr) {

        fin_tx_desc_ptr = fin_tx_desc_ptr->next;
    }

}

static void chk_link(void)
{
    unsigned int reg;

    reg = mdio_read(0, 0x01);

    if (reg & 0x0004) {
        if (!plugged) {
            plugged = 1;
            reset_phy();
            *((volatile unsigned int *)((0xB0002000+0x090))) = (*((volatile unsigned int *)((0xB0002000+0x090)))) | 0x101;
        }
    } else {
        if (plugged) {
            plugged = 0;
            *((volatile unsigned int *)((0xB0002000+0x090))) = (*((volatile unsigned int *)((0xB0002000+0x090)))) & ~0x101;
        }
    }
}

void ETH1_init(u8_t *mac_addr)
{

    *((volatile unsigned int *)((0xB0000200+0x10))) = (*((volatile unsigned int *)((0xB0000200+0x10)))) | (1 << 17);             
    *((volatile unsigned int *)((0xB0000200+0x40))) = ((*((volatile unsigned int *)((0xB0000200+0x40)))) & ~0xFF) | 0xA0;     

    
    *((volatile unsigned int *)((0xB0000000+0x090))) = ((*((volatile unsigned int *)((0xB0000000+0x090)))) & ~0xFFFFFF00) | 0x11111100;
    *((volatile unsigned int *)((0xB0000000+0x094))) = ((*((volatile unsigned int *)((0xB0000000+0x094)))) & ~0xFFFF) | 0x1111;

    
    *((volatile unsigned int *)((0xB0003000+0x090))) = 0x1000000;

    init_tx_desc();
    init_rx_desc();

    set_mac_addr(mac_addr);  
    reset_phy();

    *((volatile unsigned int *)((0xB0003000+0x090))) = (*((volatile unsigned int *)((0xB0003000+0x090)))) | 0x121; 
    *((volatile unsigned int *)((0xB0003000+0x0ac))) = (*((volatile unsigned int *)((0xB0003000+0x0ac)))) | 0x01250C11;  

    sysInstallISR(1, EMC1_TX_IRQn, (PVOID)ETH1_TX_IRQHandler);
    sysInstallISR(1, EMC1_RX_IRQn, (PVOID)ETH1_RX_IRQHandler);
    sysEnableInterrupt(EMC1_TX_IRQn);
    sysEnableInterrupt(EMC1_RX_IRQn);

    *((volatile unsigned int *)((0xB0003000+0x0a4))) = 0;

    sysSetTimerEvent(0, 200, (PVOID)chk_link);  
}


u8_t *ETH1_get_tx_buf(void)
{
    if(cur_tx_desc_ptr->status1 & 0x80000000)
        return(0);
    else
        return(cur_tx_desc_ptr->buf);
}

void ETH1_trigger_tx(u16_t length, struct pbuf *p)
{
    struct eth_descriptor volatile *desc;
    cur_tx_desc_ptr->status2 = (unsigned int)length;
    desc = cur_tx_desc_ptr->next;    
    cur_tx_desc_ptr->status1 |= 0x80000000;
    cur_tx_desc_ptr = desc;

    *((volatile unsigned int *)((0xB0003000+0x0a0))) = 0;

}


